---
title: "Dr. Hu's R Workshop"
subtitle: "Lecture I: Hello R!"
author: "Yue Hu"
institute: "Political Science, Tsinghua University"
# date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: 
      - ../../css/zh-CN_custom.css
      - ../../css/styles.css
      - "https://use.fontawesome.com/releases/v5.6.0/css/all.css"
      - "https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css"
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    chakra: ../../libs/remark-latest.min.js # to show slides offline
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)


if (!require(pacman)) install.packages("pacman")
library(pacman)

p_load(
  flextable,
  knitr, # dependency
  readxl, haven, descr, stringr, broom, tidyverse
) # data wrangling # data wrangling

# Functions preload
set.seed(114)
```


# R Workshop Series

* **R basics**
* Data manipulation
* Statistical/econometric analysis
* Data visualization
* Reproduction

---

# How to Get the Slides?


1. Opening my website [https:\\sammo3182.github.io](https:\\sammo3182.github.io) at any browser you like (even your phone);
1. Search for "Dr Hu's R Workshop";
1. Click the hyperlink "slides."

---

## What's R?

* **Object-oriented** (OO)
* A high-level language

--


.center[<img src="images/languageLevel.jpg" height = 350 />]


???

* Implement of S(tatistical) language, S3, S4 standards.

* Named after Ross Ihaka /i:haka/, and Robert Gentelman

* High-level > assembly language > machine language > hardware

* High-level: C, JAVA, Python, Fortun, R

* Friendly tips: STATA (C), SPSS (JAVA), SAS, Minitab

---

class: middle,bottom,small

## What Can R Do? An Incomplete List

--
* Statistics and econometrics.

--
* Crunching small, middle, or big sizes of data.

--
* Edit and running codes from Excel, STATA, Python, C++, ...

--
* Scrape data from local files, websites, databases, pdf...

--
* Create webpages (e.g., [`blogdown`](https://bookdown.org/yihui/blogdown/).)

--
* Write academic articles, books, or dissertations in html, pdf, or docx (e.g., [`bookdown`](https://bookdown.org/home/).)

--
* Create presentation slides in pdf, html, or PowerPoint.

--
* ......

---

## Why R?

* FREE!!

--

* Popular

.center[<img src="images/rank.jpeg" height = 350 />]


---

* All platform compatible: Windows, Linux, macOS

--

* Getting a job

```{r jobs}
tibble::tribble(
                            ~Company, ~Application,
                           "Twitter", "Monitor user experience",
                              "Ford", "Analyse social media to support design decisions for their cars",
                    "New York Times", "Infographics, data journalism",
                         "Microsoft", "Released Microsoft R Open, an enhanced R distribution and Microsoft\n R server after acquiring Revolution Analytics in 2015",
                            "Google", "Created the R style guide for the R user community inside Google"
  ) %>% flextable() %>% 
  align(align = "left", part = "all") %>% 
  fontsize(size = 20, part = "all")
```

--

* In Developing
    + `r nrow(available.packages())`+ packages for cutting-edges

---

## So, how about...

Python, STATA, SPSS, Excel...

---

background-image: url("images/programCompare.jpg")
background-position: center
background-size: contain

---

.left-column[
### R

#### Advantages

* Fresh
* Flexible

#### Inconvenience

* Linear-algebraic calculation
* Programming

]

.right-column[
### STATA

#### Advantages

* Stable
* Reliable

#### Inconvenience

* Use what you get
* Poor visualization
* EXPENSIVE: SE
    + Annual:	$235 student/**year**

]


---

.left-column[
### R

#### Advantages

* Statistics
* Visualization

#### Inconvenience

* Large-size (> 1G) data
]

.right-column[
### Python

#### Advantages

* Machine learning
* Big data

#### Inconvenience

* Setting up & 2.7 vs. 3.5?
* Outcomes?

]

---

## So, if you choose R,

Be prepared...

.center[<img src="images/LearningCurve.png" height = 400 />]
.small[[Source: NYU Data Service](https://sites.google.com/a/nyu.edu/statistical-software-guide/summary)]

---

### Preparing for the *wonderful* moments~

.center[<img src="images/pc2weeks.gif" height = 480, width = 750 />]



---

class:inverse

# Ready? Shall We Begin~

.center[<img src="images/begin.gif" height = 300 />]

---

## Program Installation

.left-column[
### Core program

[<img src="images/Rlogo.png" height = 200 />](https://www.r-project.org/)

]

--

.right-column[
### Graphic User Interfaces (GUI)

[<img src="images/rstudio.jpg" height = 250 />](https://www.rstudio.com/)

]

---

## Keep Updating

* Keep your R & Rstudio updated!
    + Keep your R & Rstudio updated!
        + Keep your R & Rstudio updated!
        
--

* [Rstudio Preview](https://www.rstudio.com/products/rstudio/download/preview/)
* [Rstudio Daily Builds](https://dailies.rstudio.com/)

---

## Startup

### Knowing about your working environment

```{r system}
Sys.info()
```

---

```{r session}
sessionInfo()
```

---

## Startup Files

### What are they?

* `.Rprofile`/`Rprofile.site`
* `.Renviron`/`Renviron.site`

--

### Where are they?

* `R_HOME`: Where you installed R
* `HOME`: User's home directory, `R.home()`
* WD: working directory, `getwd()`

---

## What can you do with them?

Suggestion: Put your startup files in `./etc/`

--

`Renviron.site`: 

```
## Windows
R_LIBS_USER=D:/userLib
TMPDIR=D:/Rtemp 
TMP=D:/Rtemp 
TEMP=D:/Rtemp
```

---

`Rprofile.site`:

```
# General options 
options(tab.width = 2) 
options(width = 89)
options(graphics.record=TRUE) 

## Customization
Sys.setlocale(, "Chinese")

options(Ncpus = 6)
```

---

## Rstudio Global Options

Let's have a look at how Rstudio works~

---

## Packages


<img src="images/apps.jpeg" height = 400 />


---

## Package Installation

* Installing:

```{r installPg, eval=FALSE}
install.packages(<package name>)
devtools::install_github("<repositary/package name>")
remotes::install_github("<repositary/package name>")
```

--

* Calling:

```{r usingPg, eval=FALSE}
library(<package name>)
require(<package name>)

package::function
```

---

## First-Time Using

* Set the working directory! 
    + Set the working directory! 
        + Set the working directory!

```{r eval = FALSE}
# Find
getwd() 

# Reset
setwd("./rworkshop") 
```
    

---

<img src=images/wdSetting.gif height = "600"/>


---

## Better Way: 

Create a project!

Let me show you how amazing it is:

---

# Terminology

--

### Matrix

.left-column[

<img src=images/matrix.gif height = "150"/>

]

--

.right-column[

```{r matrix}
A <- matrix(-8:7, ncol = 4)
A
A[2, 3]
```

]

---

### Vector: 

```{r}
# Numeric
c(1, 2, 3) # Integer
c(1.5, -2.34, NA) #Double
# Factor
factor(c(1, 2, 2, 3), labels = c("Apple", "Pear", "Orange"))

```

---

```{r}
# Character
c("R is hard.", "But I can nail it.")

# Time
as.POSIXlt("2005-10-21 18:47:22")

# Logic
c(TRUE, TRUE, FALSE)
```


---

### Data frame

```{r dfEG, echo=FALSE}
kable(head(mtcars[1:3, 1:4]), format='html')
```

--

.left-column[
```{r}
mtcars[1,1]
```
]

--

.right-column[
```{r}
mtcars$mpg[1]
```

]

---

### Array

A multi-dimension matrix

```{r}
array(-9:9, dim = c(3,3,2)) 
```

---

### List

A series of everything.

```{r}
aList <- list(c(1:5), letters[1:5])
aList
aList[[2]]
```

---

## Quick History

`<-` is equivalent to `=` in R (`<<-` also exists)

.center[<img src=images/APLkeyBoard.png height = "200"/>]

???

Assigned operator

---

## Why do we still use it? 

Readability

```{r arrow, eval = FALSE}
a <- 12
25 -> b
```

---

Side effect

```{r sideEffect, error = TRUE}
median(x = 1:10); x
median(x <- 1:10); x
```

Short key: `Alt + -`

---

### Functions

.center[<img src=images/handShadow.gif height = "250"/>]

--

```{r}
light <- function(finger){
  {{shadow <- finger + 5}}
}

handShadow <- light(finger = 3)
handShadow
```

---

## Doing Math with R

```{r eval=FALSE}
# basic math
x + (1 - 2) * 3 / 4

# advanced math
x^2;sqrt(x);log(x);exp(x)

# matrix algebra
z <- matrix(1:4, ncol = 2)
z + z - z
z %*% z  # inner multiplication
z %o% z  # outter multiplication

# logical evaluation
x == z; x != Z
x & z; x | z
x > z; x <= z
```


---

## Naming Rules

* Don't start with numbers (WRONG: `1stday`)

--

* No special signs except for `.` and `-` (WRONG: `M&M`)

--

* Case sensitivity (`X != x`)

--

* Don't overwrite the build-in functions unless necessary (DON'T: `list <- c(1:5)`)

---

## Coding 

Proper spaces and indents

```{r codingRules}
AddValues <- function(x, y){
  return(x + y)
}

```

---

class: inverse, bottom

# Data Input and Output

---

## Input

```{r eval=FALSE}
load("<FileName>.RData")

df_rds <- readRDS("<FileName>.rds")
df_txt <- read.table("<FileName>.txt")
df_csv <- read.csv("<FileName>.csv")

```

---

## Talk to Others

```{r eval=FALSE}
# SPSS, Stata, SAS
library(haven)
df_spss <- read_spss("<FileName>.sav")
df_stata <- read_dta("<FileName>.dta") 
df_sas <- read_sas("<FileName>.sas7bdat")  

# Excel sheets
library(readxl)
df_excel <- read_excel("<FileName>.xls")
df_excel2 <- read_excel("<FileName>.xlsx") 

# JavaScript Object Notation 
library(rjson)
df_json <- fromJSON(file = "<FileName>.json" )

# XML/Html
df_xml <- xmlTreeParse("<url>")
df_html <- readHTMLTable(url, which=3)

# Featherf
feather::read_feather("<FileName>.feather")
```

---

## Where Do Things Live in R

You know Excel, right? 

---
## Data 

Excel
.center[<img src=images/excel-r1.png height = "150"/>]


R
.center[<img src=images/excel-r2.png height = "200"/>]

---

## Operation

Excel
.center[<img src=images/excel-r3.png height = "150"/>]


R
.center[<img src=images/excel-r4.png height = "200"/>]

---

## Results

Excel
.center[<img src=images/excel-r3.png height = "150"/>]


R
.center[<img src=images/excel-r5.png height = "250"/>]



---

class: small

## Output

* Save a single object in a `.rds` file

```{r eval = F}
saveRDS(object, file = "./Data/mydata.Rds")
```

* Save objects into an R data frame (`.RData`/`.rda`) 

```{r eval = F}
save(object, file = "./Data/mydata.Rdata")
```

* Save objects into a CSV sheet `.csv`

```{r eval = F}
write.csv(object, file = "mydata.csv")
```

* Save objects into a `feather` file

```{r eval = F}
write_feather(object, file = "mydata.feather")
```

---

## Which way should you use?

A benchmark:

```{r saving}
##Unit: seconds
##        expr   min    lq       mean median    uq   max neval
##     readCSV 200.0 200.0 211.187125  210.0 220.0 240.0    10
##    readrCSV  27.0  28.0  29.770890   29.0  32.0  33.0    10
##       fread  15.0  16.0  17.250016   17.0  17.0  22.0    10
##   loadRdata   4.4   4.7   5.018918    4.8   5.5   5.9    10
##     readRds   4.6   4.7   5.053674    5.1   5.3   5.6    10
## readFeather   1.5   1.8   2.988021    3.4   3.6   4.1    10
```


---

class: inverse, bottom


## Take-Home Points

--

* Being aware of the learning curve

--

* Preparing for unexpected troubles

--

* Sufficiently using online sources

Hint: Search "let me google that for you" in the urban dictionary

--

Just kidding~

---

class: center, middle

# Thank you!

<i class="fa fa-envelope fa-lg"></i>&nbsp; [yuehu@tsinghua.edu.cn](mailto:yuehu@tsinghua.edu.cn)

<i class="fa fa-globe fa-lg"></i>&nbsp; https://sammo3182.github.io/

<i class="fab fa-github fa-lg"></i>&nbsp; [sammo3182](https://github.com/sammo3182)