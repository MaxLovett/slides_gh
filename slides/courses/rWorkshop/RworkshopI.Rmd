---
title: "Learning R"
subtitle: "With Dr. Hu and His Friends"
author: "Yue Hu"
institute: "Political Science, Tsinghua University"
output:
  xaringan::moon_reader:
    css: 
      - default
      - zh-CN_custom.css
      - style_ui.css
    mathjax: "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js?config=TeX-MML-AM_HTMLorMML"
    chakra: libs/remark-latest.min.js
    nature:
      highlightStyle: github
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: false
      ratio: 16:9
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

htmltools::tagList(rmarkdown::html_dependency_font_awesome()) #fontawesome

if (!require(pacman)) install.packages("pacman")
library(pacman)

p_load(
  flextable,
  knitr, # dependency
  readxl, haven, descr, stringr, broom, tidyverse
) # data wrangling # data wrangling

# Functions preload
set.seed(114)
```


## Workshop Series (Fall)

.pull-left[

### Foundations

+ .red[Should I learn R]
+ .red[Data input/Output]
+ Data munging
+ Data visualization
+ Data analysis

]

.pull-right[

### R Ecology

+ Batch processing
+ Adv. visualization
+ Rmarkdown and Academic Writing
+ Version control w. R
]

--

.full-column[
.center[
### R Survivor (Badge)

<img src="https://user-images.githubusercontent.com/58319029/114663100-59769e80-9d2c-11eb-912b-64303aad256d.png" height = 200 />]
]

---

## Workshop Series (Spring)

.pull-left[
### Applied Econometrics

+ Multilevel modeling
+ Latent variable analysis
+ Time series analysis
+ Bayesian analysis

]

.pull-right[
### Computing Social Science

+ Text analysis
+ Spatial analysis
+ Network analysis
+ Machine learning
+ R Salon
]

--

.full-column[
.center[
### R Expert (Certificate)

<img src="https://user-images.githubusercontent.com/58319029/109610431-b5fc7080-7b67-11eb-9bfb-988bd1759c50.png" height = 200 />]
]

---

## Should I Take?

### Fall series

* Not R user yet;
* Knowing Excel/SPSS/STATA/Python/Matlab...and not very into it;
* My advisor/boss/mom ordering me to learn it;
* Needing friends!

--

### Spring series

+ Mediocre R users;
+ Wanting to see the true power of R;
+ Hoping to be the cool kid among peers;
+ Having something to teach others.

---

## Overview of Today

+ Bio of R
+ Why R, not Python/STATA
+ Inputting almost all types of data into R
+ Storing and combining datasets 
+ Output outcome data


---

## What's R?

* A high-level .red[language]

.center[<img src="images/languageLevel.jpg" height = 350 />]


???

* Implement of S(tatistical) language, S3, S4 standards.

* Named after Ross Ihaka /i:haka/, and Robert Gentelman
    + Python: British comedy group Monty Python, whom Python creator Guido van Rossum enjoyed
    + STATA: Stats + Data
    + SPSS (Statistical Package for the Social Sciences, created by Norman Nie and several poli sci grads in Stanford)

* High-level > assembly language (only using ADD, MOVE, etc.) > machine language (010101) > hardware

* High-level: C, JAVA, Python, Fortun, R

* Friendly tips: STATA (C), SPSS (JAVA), SAS, Minitab

--

* **Object-oriented** programming (OOP): Class &rarr; objects
    + Carb &rarr; Steam ban
    + University &rarr; Tsinghua

???

C++, Python, Ruby, Perl, Matlab

---

class: center , bottom

## What Can R Do?

--

Statistics and econometrics.

--

Crunching almost any sizes of data.

--

Edit and running codes from Excel, STATA, Python, C++, ...

--

Scrape data from local files, websites, databases, pdf...

--

Create webpages

--

Write academic articles, books, or dissertations in html, pdf, or docx

--

Create presentation slides

--

Sending emails

--

......

---

## Why R?

### Timeliness

```{r coronavirus, echo=FALSE, out.height="50%", fig.align='center'}
library(coronavirus)
library(scales)

#-----------------Country-specific totals------------------------

# colours for male and female used by Washington Post 2017; see https://blog.datawrapper.de/gendercolor/
sex_cols <- c(Male = "#F4BA3B", Female =  "#730B6D")


#---------------------Italian fatality rates---------

italy_rates <-tibble(
  age_grp = rep(c('0-9', '10-19', '20-29', '30-39', '40-49', '50-59', '60-69', '70-79', '80-89', '90+'), 2),
  sex = rep(c("Male", "Female"), each = 10),
  cfr = c(0, 0, 0, 0.6, 0.7,   1.7, 6.0, 17.8, 26.4, 32.5,
          0, 0, 0, 0.2,   0.4, 0.6, 2.8,  10.7, 19.1,   22.3) / 100,
  age_midpt = rep(c(5, 15, 25, 35, 45, 55, 65, 75, 85, 95), 2)
)


italy_rates %>%
  ggplot(aes(x = age_midpt, y = cfr, colour = sex)) +
  geom_point() +
  geom_text(data = filter(italy_rates, cfr > 0.01),
            aes(label = percent(cfr), y = cfr + 0.012), size = 3) +
  geom_line() +
  scale_x_continuous(breaks = italy_rates$age_midpt, labels = italy_rates$age_grp) +
  scale_y_continuous(label = percent_format(accuracy = 1)) +
  scale_colour_manual(values = sex_cols) +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank()) +
  labs(x = "Age group", colour = "", y = "Observed case fatality rate",
       title = "Observed fatality rate of diagnosed COVID-19 cases in Italy to 19 March 2020",
       subtitle = "20,686 men and boys with case fatality rate of 10.3%;\n 14,378 women and girls with case fatality rate of 6.2%",
       caption = "Source: Istituto Superiore di Sanit√†, Roma")

```

---

background-image: url("images/hillShade.png")
background-position: center
background-size: contain

### Beautiful

```{r 3dmap, eval=FALSE, echo=FALSE, out.height= "60%", results = "hide", fig.align='center'}
library(rayshader)

localtif <-  raster::raster("data/dem_01.tif")
elmat <- raster_to_matrix(localtif)

elmat %>%
  sphere_shade(texture = "desert") %>%
  add_water(detect_water(elmat), color = "desert") %>%
  add_shadow(ray_shade(elmat, zscale = 3), 0.5) %>%
  add_shadow(ambient_shade(elmat), 0) %>%
  plot_3d(elmat, zscale = 10, fov = 30, theta = -225, phi = 25, windowsize = c(1000, 800), zoom = 0.3)

Sys.sleep(0.2)

render_depth(focus = 0.6, focallength = 200, clear = TRUE)
```

???

https://www.rayshader.com/

---

background-image: url("images/distributionHill.png")
background-position: center
background-size: contain


```{r 3dscatter1, eval=FALSE, echo=FALSE, out.height= "90%", results = "hide", fig.align='center'}

ggdiamonds <- ggplot(diamonds) +
  stat_density_2d(aes(x = x, y = depth, fill = stat(nlevel)), 
                  geom = "polygon", n = 100, bins = 10, contour = TRUE) +
  facet_wrap(clarity~.) +
  scale_fill_viridis_c(option = "A")

par(mfrow = c(1, 2))

plot_gg(ggdiamonds, width = 5, height = 5, raytrace = FALSE, preview = TRUE)

plot_gg(ggdiamonds, width = 5, height = 5, multicore = TRUE, scale = 250, 
        zoom = 0.7, theta = 10, phi = 30, windowsize = c(800, 800))

Sys.sleep(0.2)

render_snapshot(clear = TRUE)
```

---

background-image: url("images/scatterHill.png")
background-position: center
background-size: contain

```{r 3dscatter2, eval=FALSE, echo=FALSE, out.height= "90%", results = "hide", fig.align='center'}

mtplot <- ggplot(mtcars) + 
  geom_point(aes(x = mpg, y = disp, color = cyl)) + 
  scale_color_continuous(limits = c(0, 8))

par(mfrow = c(1, 2))

plot_gg(mtplot, width = 3.5, raytrace = FALSE, preview = TRUE)

plot_gg(mtplot, width = 3.5, multicore = TRUE, windowsize = c(800, 800), 
        zoom = 0.85, phi = 35, theta = 30, sunangle = 225, soliddepth = -100)

Sys.sleep(0.2)
render_snapshot(clear = TRUE)
```


---

### Practical

```{r jobs, echo = FALSE}
tibble::tribble(
                            ~Company, ~Application,
                           "Twitter", "Monitor user experience",
                              "Ford", "Analyse social media to support design decisions for their cars",
                    "New York Times", "Infographics, data journalism",
                         "Microsoft", "Released Microsoft R Open, an enhanced R distribution and Microsoft\n R server after acquiring Revolution Analytics in 2015",
                            "Google", "Created the R style guide for the R user community inside Google"
  ) %>% 
  flextable() %>% 
  autofit() %>% 
  align(align = "left", part = "all") %>% 
  fontsize(size = 20, part = "all")

```

---

### Evolutive

`r nrow(available.packages())`+ packages for cutting-edges
    
---

background-image: url("images/programCompare.jpg")
background-position: center
background-size: contain

???

R in SPSS eyes: Heathkit EC-1, an old computer, 

---

.pull-left[
### R

#### Advantages

* Fresh
* Flexible

#### Inconvenience

* Linear-algebraic calculation
* Programming

]

.pull-right[
### STATA

#### Advantages

* Stable
* Reliable

#### Inconvenience

* Use what you get
* Fair visualization
* EXPENSIVE: SE
    + Annual:	$235 student/**year**

]


---

.pull-left[
### R

#### Advantages

+ Academic works
+ Data analysis
+ Visualization

#### Inconvenience

+ RAM vs. Large-size data

]

.pull-right[
### Python

#### Advantages

* Machine learning
* Automation in products (Java, C++?)

#### Inconvenience

+ GUI
+ Visualization

]

---

class: center, middle

## Which Is Right for You

Are you a .red[programmer] already?
+ Yes: Python

--

What do your .red[colleagues] use?
+ STATA, SPSS, SAS: R

--

How important are .red[plots] for you?
+ Ones that can impress people: R

--

What .red[problems] do you often solve?
+ Research: R; Production: Python

---

## So, if you choose to stay...

.center[<img src="images/LearningCurve.png" height = 500 />]
.center[.small[[Source: NYU Data Service](https://sites.google.com/a/nyu.edu/statistical-software-guide/summary)]]

---

You'll definitely get *wonderful* moments~

.center[<img src="images/pc2weeks.gif" height = 400, width = 750 />]

--

Oh, don't take this wrong, you will still get such moments when learning Python, Java, or Stata...

---

class: inverse, bottom

# Shall We Begin?

.center[<img src="images/begin.gif" height = 300 />]

---

## Software Preparation

.pull-left[
### Core program

.center[[<img src="images/Rlogo.png" height = 200 />](https://www.r-project.org/)]

]

--

.pull-right[
### Graphic User Interfaces (GUI)

.center[[<img src="images/rstudio.jpg" height = 250 />](https://www.rstudio.com/)]

]

---

## Packages

.pull-left[<img src="images/apps.jpeg" height = 400 />]

.pull-right[

+ Installing

```{r installPg, eval=FALSE}
install.packages("drhur")
devtools::install_github("sammo3182/drhur")
remotes::install_github("sammo3182/drhur")
```

+ Calling

```{r usingPg, eval=FALSE}
library(drhur)
require(drhur)

drhur::drhur("playing")
```

]

---

class: center, middle

# Thank you!

<i class="fa fa-envelope fa-lg"></i>&nbsp; [yuehu@tsinghua.edu.cn](mailto:yuehu@tsinghua.edu.cn)

<i class="fa fa-globe fa-lg"></i>&nbsp; https://sammo3182.github.io/

<i class="fab fa-github fa-lg"></i>&nbsp; [sammo3182](https://github.com/sammo3182)

```{r pdfPrinting, eval = FALSE, include = FALSE}
pagedown::chrome_print(list.files(pattern = "RworkshopI.*.html"), timeout = 300)
```