<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>计算机辅助文本分析·操作</title>
    <meta charset="utf-8" />
    <meta name="author" content="胡悦" />
    <script src="07_textAnalaysisII_files/header-attrs-2.9.2/header-attrs.js"></script>
    <link href="07_textAnalaysisII_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="07_textAnalaysisII_files/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
    <link href="07_textAnalaysisII_files/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
    <link href="07_textAnalaysisII_files/tile-view-0.2.4/tile-view.css" rel="stylesheet" />
    <script src="07_textAnalaysisII_files/tile-view-0.2.4/tile-view.js"></script>
    <link href="07_textAnalaysisII_files/tachyons-4.12.0/tachyons.min.css" rel="stylesheet" />
    <link href="07_textAnalaysisII_files/panelset-0.2.4/panelset.css" rel="stylesheet" />
    <script src="07_textAnalaysisII_files/panelset-0.2.4/panelset.js"></script>
    <script src="07_textAnalaysisII_files/js-cookie-3.0.0/js.cookie.js"></script>
    <script src="07_textAnalaysisII_files/peerjs-1.3.1/peerjs.min.js"></script>
    <script src="07_textAnalaysisII_files/tiny.toast-1.0.0/toast.min.js"></script>
    <link href="07_textAnalaysisII_files/xaringanExtra-broadcast-0.2.4/broadcast.css" rel="stylesheet" />
    <script src="07_textAnalaysisII_files/xaringanExtra-broadcast-0.2.4/broadcast.js"></script>
    <script src="07_textAnalaysisII_files/htmlwidgets-1.5.3/htmlwidgets.js"></script>
    <link href="07_textAnalaysisII_files/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet" />
    <script src="07_textAnalaysisII_files/wordcloud2-0.0.1/wordcloud2-all.js"></script>
    <script src="07_textAnalaysisII_files/wordcloud2-0.0.1/hover.js"></script>
    <script src="07_textAnalaysisII_files/wordcloud2-binding-0.2.1/wordcloud2.js"></script>
    <link rel="stylesheet" href="zh-CN_custom.css" type="text/css" />
    <link rel="stylesheet" href="style_ui.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# 计算机辅助文本分析·操作
## Learning Text Analysis in Practice with Dr. Hu
### 胡悦
### 清华大学政治学系

---





## Overview

.pull-left[
### 文字分析

+ 词频分析
+ 信息提取
+ 情感标记
+ 语义网络

]

.pull-right[
### 文本分析

+ 文本分类
+ 文本聚类
+ 语义联系*

]

--

### 技术来源 （R）

[`rvest`](https://rvest.tidyverse.org/)   
[`jiebaR`](https://qinwenfeng.com/jiebaR/)/[`TopWORDS`](http://www.stat.tsinghua.edu.cn/kdeng/r-package/)    
[`tidytext`](https://www.tidytextmining.com/)   
[`quanteda`](https://quanteda.io/index.html) series

---

class: inverse, bottom

# 文字分析

---

## 何为文字分析

+ 单位：词、句、段、章

--

+ 目的和方法：
    + 写作特征 &amp;larr; 词频分析
    + 用语特征 &amp;larr; 信息提取
    + 情绪特征 &amp;larr; 情感分析
    + 概念关系 &amp;larr; 语义网络

--

+ 分析案例

.center[&lt;img src="images/text_xiSpeech.jpg" height = 220 /&gt;]

---

## 数据获取

From html

1. 打开来源网站[新华网](http://www.xinhuanet.com/politics/2021-07/15/c_1127658385.htm)
1. `SelectorGadget` 选择内容部分
1. 使用scraper进行抓取（以`rvest`为例)


```r
library(tidyverse) # data cleaning and management
library(rvest)

link_speech &lt;- "http://www.xinhuanet.com/politics/2021-07/15/c_1127658385.htm"

tx_xi &lt;- read_html(link_speech) %&gt;% 
  html_nodes("p") %&gt;%
    html_text

head(tx_xi)
```

```
## [1] "在庆祝中国共产党成立100周年大会上的讲话"                                                                                                                  
## [2] "（2021年7月1日）"                                                                                                                                         
## [3] "习近平"                                                                                                                                                   
## [4] ""                                                                                                                                                         
## [5] "　　2021年7月1日，庆祝中国共产党成立100周年大会在北京天安门广场隆重举行。中共中央总书记、国家主席、中央军委主席习近平发表重要讲话。　新华社记者 谢环驰/摄"
## [6] "同志们，朋友们："
```



---

## 简单清理

1. 去掉前五行无关内容
1. 将所有段合并


```r
paragraph_xi &lt;- tx_xi[6:length(tx_xi)]
tx_xi &lt;- paragraph_xi %&gt;% paste(collapse = "")
substr(tx_xi, 1, 50)
```

```
## [1] "同志们，朋友们：　　今天，在中国共产党历史上，在中华民族历史上，都是一个十分重大而庄严的日子。我们在"
```

```r
# Saving the data to local
# writeLines(tx_xi, file("data/tx_xi.txt", encoding = "UTF-8")) 
```

---

From text


```r
tx_xi &lt;- readLines("data/tx_xi.txt", encoding = "UTF-8")
substr(tx_xi, 1, 50)
```

```
## [1] "同志们，朋友们：　　今天，在中国共产党历史上，在中华民族历史上，都是一个十分重大而庄严的日子。我们在"
```

From pdf


```r
library(pdftools)
# library(tesseract) # Loading this package if you need ocr

pdf_xi &lt;- pdf_text("data/tx_xi.pdf")
pdf_xi[1]
```

```
## [1] "中共中央总书记、国家主席、中央军委主席\n      习近平同志在庆祝中国共产党成立\n       100 周年大会上的重要讲话\n\n  中共中央总书记、国家主席、中央军委主席习近平\n\n\n同志们，朋友们：\n  今天，在中国共产党历史上，在中华民族历史上，都是一个\n十分重大而庄严的日子。我们在这里隆重集会，同全党全国各族\n人民一道，庆祝中国共产党成立一百周年，回顾中国共产党百年\n奋斗的光辉历程，展望中华民族伟大复兴的光明前景。\n  首先，我代表党中央，向全体中国共产党员致以节日的热烈\n祝贺！\n  在这里，我代表党和人民庄严宣告，经过全党全国各族人民\n持续奋斗，我们实现了第一个百年奋斗目标，在中华大地上全面\n建成了小康社会，历史性地解决了绝对贫困问题，正在意气风发\n向着全面建成社会主义现代化强国的第二个百年奋斗目标迈进。\n这是中华民族的伟大光荣！这是中国人民的伟大光荣！这是中国\n共产党的伟大光荣！\n  同志们、朋友们！\n  中华民族是世界上伟大的民族，有着 5000 多年源远流长的\n\n\n\n               - 1 -\n"
```

???

https://alexluscombe.ca/blog/getting-your-.pdfs-into-r/

---

## 文字处理

Tokenizing + Segmenting


```r
library(jiebaR)

cutter &lt;- worker() # segment engine
segment(tx_xi, cutter)[1:20]
```

```
##  [1] "同志"       "们"         "朋友"       "们"        
##  [5] "　"         "　"         "今天"       "在"        
##  [9] "中国共产党" "历史"       "上"         "在"        
## [13] "中华民族"   "历史"       "上"         "都"        
## [17] "是"         "一个"       "十分"       "重大"
```

--

.pull-left[
### Tokenizing
1. 去掉空格、标点、特殊符号
1. 自定义停词（不想计入统计之词)
1. 标记词性
1. Stemming*
]

.pull-right[
### Segmenting

Languages w.o. inter-word spaces

1. 选择分词器（Rwordseg, jiebaR, etc.）
1. 自定义专有之词
]

---


```r
library(stringr)

tx_xi &lt;- str_remove_all(tx_xi, "\\s|\\t|\\n|\\r|\\v|\\f")

# Saving the stopwords to a file so as to be accessed by jiebaR functions
stopwords::stopwords("zh", source = "stopwords-iso") %&gt;% 
  writeLines(file("data/stopwords.txt", encoding = "UTF-8")) # make sure saving stuff with utf-8

cutter &lt;- worker(type = "tag", # tagging
                 stop_word = "data/stopwords.txt") 

new_user_word(cutter, "同志们", "r") # customize segmentation
```

```
## [1] TRUE
```

```r
new_user_word(cutter, "朋友们", "r") 
```

```
## [1] TRUE
```

---


```r
seg_xi &lt;- segment(tx_xi, cutter)
seg_xi[1:50]
```

```
##            r            r            t           nt            n 
##     "同志们"     "朋友们"       "今天" "中国共产党"       "历史" 
##           nz            n            m            m            a 
##   "中华民族"       "历史"       "一个"       "十分"       "重大" 
##            a            n           nz           nt            l 
##       "庄严"       "日子"   "隆重集会"   "全党全国"   "各族人民" 
##            m            v           nt            v            m 
##       "一道"       "庆祝" "中国共产党"       "成立"   "一百周年" 
##            v           nt            m            v           nr 
##       "回顾" "中国共产党"       "百年"       "奋斗"       "光辉" 
##            n            v           nz            a            a 
##       "历程"       "展望"   "中华民族"       "伟大"       "复兴" 
##            n            n            n           nt           ns 
##       "光明"       "前景"       "代表"     "党中央"       "中国" 
##            n            v            t           ns            n 
##   "共产党员"       "致以"       "节日"   "热烈祝贺"       "代表" 
##            n           nr           nt            l           vd 
##   "党和人民"   "庄严宣告"   "全党全国"   "各族人民"       "持续" 
##            v            v            m            m            l 
##       "奋斗"       "实现"     "第一个"       "百年"   "奋斗目标"
```



---

## 词频分析

Do you remember the BOW? 


```r
freq_xi &lt;- freq(seg_xi)
arrange(freq_xi, desc(freq))
```

```
##               char freq
## 1             中国   80
## 2             人民   67
## 3       中国共产党   57
## 4         中华民族   44
## 5             伟大   41
## 6               新   36
## 7             发展   33
## 8             实现   33
## 9             坚持   30
## 10        社会主义   27
## 11            复兴   26
## 12            历史   25
## 13              党   24
## 14            必须   20
## 15            全面   18
## 16            世界   17
## 17            推进   16
## 18            奋斗   16
## 19            时代   16
## 20            建设   14
## 21            特色   13
## 22            百年   12
## 23            团结   12
## 24            未来   12
## 25          一百年   11
## 26            征程   11
## 27            开创   11
## 28            民族   10
## 29      马克思主义   10
## 30            创造   10
## 31            始终   10
## 32        以史为鉴   10
## 33          同志们    9
## 34          朋友们    9
## 35            国家    9
## 36            不断    9
## 37            成立    8
## 38            没有    8
## 39            带领    8
## 40            领导    8
## 41            推动    8
## 42            社会    7
## 43            成为    7
## 44          现代化    7
## 45            命运    7
## 46            和平    7
## 47            思想    7
## 48            制度    7
## 49            革命    7
## 50            继续    7
## 51            深刻    7
## 52            维护    7
## 53            贯彻    7
## 54            更为    6
## 55            起来    6
## 56            多年    6
## 57            政治    6
## 58            一个    6
## 59        党和人民    6
## 60            强军    6
## 61          历史性    6
## 62            代表    6
## 63            力量    6
## 64            建立    6
## 65            精神    6
## 66              走    5
## 67            挑战    5
## 68            战胜    5
## 69        奋斗目标    5
## 70            英勇    5
## 71            斗争    5
## 72            根本    5
## 73            使命    5
## 74            顽强    5
## 75        庄严宣告    5
## 76            取得    5
## 77            青年    5
## 78            道路    5
## 79            风险    5
## 80            同志    5
## 81            文明    5
## 82        中华儿女    5
## 83            牢记    5
## 84            坚强    5
## 85            利益    5
## 86        伟大成就    5
## 87            安全    4
## 88            强大    4
## 89            四个    4
## 90            协调    4
## 91            统筹    4
## 92            捍卫    4
## 93            开放    4
## 94            形成    4
## 95            不负    4
## 96            全国    4
## 97            坚定    4
## 98            前途    4
## 99            问题    4
## 100       各族人民    4
## 101       人民军队    4
## 102           致以    4
## 103           深切    4
## 104           今天    4
## 105           庆祝    4
## 106           增强    4
## 107       历史进程    4
## 108             正    4
## 109           执政    4
## 110           2021    4
## 111           初心    4
## 112             前    4
## 113           具有    4
## 114           进行    4
## 115         习近平    4
## 116         新华社    4
## 117           记者    4
## 118           构建    4
## 119            100    4
## 120           永远    4
## 121           怀念    4
## 122           广大    4
## 123       党和国家    4
## 124           过去    4
## 125           江山    4
## 126           能力    4
## 127       人类文明    4
## 128           重要    4
## 129           战略    4
## 130           努力    3
## 131           目标    3
## 132             搞    3
## 133           人类    3
## 134       国家主权    3
## 135           一起    3
## 136           事业    3
## 137           5000    3
## 138           加强    3
## 139           提供    3
## 140           彻底    3
## 141           保证    3
## 142           善于    3
## 143           民主    3
## 144           压迫    3
## 145              6    3
## 146         第二个    3
## 147           强国    3
## 148           引领    3
## 149           建成    3
## 150       伟大光荣    3
## 151           汪洋    3
## 152             守    3
## 153           重大    3
## 154           能够    3
## 155           这是    3
## 156           牺牲    3
## 157           近代    3
## 158           成就    3
## 159         党中央    3
## 160           体系    3
## 161           亿多    3
## 162       伟大工程    3
## 163             旧    3
## 164         王岐山    3
## 165       帝国主义    3
## 166           弘扬    3
## 167           梦想    3
## 168           改变    3
## 169           建党    3
## 170           广泛    3
## 171           确立    3
## 172         李克强    3
## 173           周年    3
## 174             栗    3
## 175           战书    3
## 176         王沪宁    3
## 177         赵乐际    3
## 178             韩    3
## 179       统一战线    3
## 180           践行    3
## 181           解决    3
## 182 马克思列宁主义    3
## 183           改革    3
## 184           祖国    3
## 185           国际    3
## 186           确保    3
## 187           凝聚    3
## 188           同胞    3
## 189             心    3
## 190             想    3
## 191           光荣    3
## 192           最大    3
## 193             14    3
## 194           拥有    3
## 195           旗帜    3
## 196       改革开放    3
## 197           保持    2
## 198           稳定    2
## 199         行政区    2
## 200           特别    2
## 201           落实    2
## 202           清除    2
## 203           一定    2
## 204       党的建设    2
## 205         大团结    2
## 206           认识    2
## 207           香港    2
## 208           面前    2
## 209             干    2
## 210           现在    2
## 211           奴役    2
## 212           欺负    2
## 213           正义    2
## 214           合作    2
## 215         共同体    2
## 216           摄新    2
## 217           鞠鹏    2
## 218         领导人    2
## 219           统一    2
## 220       精神力量    2
## 221           独立    2
## 222           坚决    2
## 223       总体布局    2
## 224           武装    2
## 225             初    2
## 226           主动    2
## 227           当代    2
## 228           总体    2
## 229           有益    2
## 230           崇高    2
## 231       经济体制    2
## 232           格局    2
## 233           大国    2
## 234       坚定不移    2
## 235       从严治党    2
## 236           破坏    2
## 237           基本    2
## 238           绝对    2
## 239           党员    2
## 240           局面    2
## 241         相结合    2
## 242           结束    2
## 243         几千年    2
## 244           解放    2
## 245 中华人民共和国    2
## 246       当家作主    2
## 247           完善    2
## 248       五位一体    2
## 249           以后    2
## 250           迈进    2
## 251           小康    2
## 252           封闭    2
## 253           自觉    2
## 254           共识    2
## 255           功勋    2
## 256           巩固    2
## 257           中华    2
## 258       基本路线    2
## 259           自信    2
## 260           全球    2
## 261       共产党员    2
## 262       全党全国    2
## 263           布局    2
## 264             70    2
## 265           时期    2
## 266           历程    2
## 267           带来    2
## 268           一道    2
## 269           群众    2
## 270           军队    2
## 271         中国化    2
## 272           组织    2
## 273     半封建社会    2
## 274           红色    2
## 275             谋    2
## 276           作出    2
## 277           血肉    2
## 278       半殖民地    2
## 279         邓小平    2
## 280         海内外    2
## 281           反对    2
## 282       仁人志士    2
## 283           之路    2
## 284           一处    2
## 285       迫切需要    2
## 286             摄    2
## 287           勇于    2
## 288           应对    2
## 289       霸权主义    2
## 290           敬意    2
## 291             站    2
## 292           历经    2
## 293           高举    2
## 294           治理    2
## 295           进程    2
## 296           特征    2
## 297           变化    2
## 298           进入    2
## 299           飞跃    2
## 300 新民主主义革命    2
## 301           光明    2
## 302           大会    2
## 303           勋章    2
## 304       隆重举行    2
## 305           科技    2
## 306           所系    2
## 307           把握    2
## 308         胡锦涛    2
## 309           史册    2
## 310           9500    2
## 311           长期    2
## 312           实践    2
## 313             出    2
## 314           血脉    2
## 315           更加    2
## 316           七一    2
## 317           主席    2
## 318         毛泽东    2
## 319           答应    2
## 320           英雄    2
## 321         指战员    2
## 322         第一个    2
## 323       敢于斗争    2
## 324           成功    2
## 325           着力    2
## 326           选择    2
## 327       美好未来    2
## 328           调动    2
## 329           关键    2
## 330           科学    2
## 331           万岁    2
## 332           依法    2
## 333       美好生活    2
## 334           进步    2
## 335         高质量    2
## 336           一派    2
## 337 澳门特别行政区    2
## 338           下去    2
## 339       基本原理    2
## 340           实际    2
## 341           不可    2
## 342           理论    2
## 343           得出    2
## 344           付出    2
## 345           正确    2
## 346           必将    2
## 347           准确    2
## 348           理念    2
## 349           和谐    2
## 350       伟大事业    2
## 351             梦    1
## 352       紧密团结    1
## 353       风华正茂    1
## 354       千秋伟业    1
## 355           向往    1
## 356       同甘共苦    1
## 357       理想信念    1
## 358           踏上    1
## 359           一份    1
## 360           迈向    1
## 361           步伐    1
## 362           气象    1
## 363       欣欣向荣    1
## 364           展现    1
## 365           景象    1
## 366           凋零    1
## 367           呈现    1
## 368         执政党    1
## 369           人口    1
## 370           已经    1
## 371           多名    1
## 372       殷切期望    1
## 373           韶华    1
## 374           底气    1
## 375           志气    1
## 376           先锋    1
## 377           融入    1
## 378         一代代    1
## 379       风雨如晦    1
## 380           火炬    1
## 381           希望    1
## 382           意志    1
## 383           恰是    1
## 384           决心    1
## 385           不要    1
## 386           图谋    1
## 387           粉碎    1
## 388           向前    1
## 389           青春    1
## 390           两岸    1
## 391       领土完整    1
## 392           包括    1
## 393       和平统一    1
## 394           九二    1
## 395           原则    1
## 396       共同愿望    1
## 397           任务    1
## 398           台湾    1
## 399           澳门    1
## 400           大局    1
## 401           执行    1
## 402           方针    1
## 403           自治    1
## 404           变味    1
## 405         多万名    1
## 406           肌体    1
## 407           健康    1
## 408           侵蚀    1
## 409         先进性    1
## 410           中央    1
## 411         反腐败    1
## 412       党风廉政    1
## 413           赶考    1
## 414       干部队伍    1
## 415         高素质    1
## 416           在内    1
## 417           以党    1
## 418           道理    1
## 419           打铁    1
## 420           前列    1
## 421           面临    1
## 422           原因    1
## 423         国内外    1
## 424       朝气蓬勃    1
## 425       千锤百炼    1
## 426           寄予    1
## 427           区别    1
## 428           磅礴    1
## 429       港人治港    1
## 430           生动    1
## 431           心往    1
## 432             画    1
## 433     最大公约数    1
## 434           天下    1
## 435         一致性    1
## 436           联合    1
## 437   爱国统一战线    1
## 438       积极因素    1
## 439           位置    1
## 440           摆在    1
## 441       遇水架桥    1
## 442       逢山开道    1
## 443           环境    1
## 444           要求    1
## 445           我国    1
## 446           法律    1
## 447           未有    1
## 448       居安思危    1
## 449       忧患意识    1
## 450           艰巨    1
## 451           信心    1
## 452           接近    1
## 453           不懈    1
## 454       顽强拼搏    1
## 455       敢于胜利    1
## 456           碰得    1
## 457       钢铁长城    1
## 458           妄想    1
## 459       绝不允许    1
## 460           病毒    1
## 461           广聚    1
## 462       澳人治澳    1
## 463           强烈    1
## 464       不畏强暴    1
## 465           崇尚    1
## 466           车轮    1
## 467           管党    1
## 468       强权政治    1
## 469           宗旨    1
## 470           博弈    1
## 471           共赢    1
## 472           互利    1
## 473           价值    1
## 474           共同    1
## 475           自由    1
## 476           公平    1
## 477         新机遇    1
## 478           一路    1
## 479           关系    1
## 480           新型    1
## 481       独立自主    1
## 482           奉行    1
## 483             赢    1
## 484           展览    1
## 485             忘    1
## 486         展览馆    1
## 487             18    1
## 488         维护者    1
## 489           高度    1
## 490           秩序    1
## 491         建设者    1
## 492       携手前进    1
## 493       进步力量    1
## 494       称王称霸    1
## 495           血液    1
## 496           追求    1
## 497           和睦    1
## 498           手段    1
## 499           可靠    1
## 500           一流    1
##  [ reached 'max' / getOption("max.print") -- omitted 550 rows ]
```

???

BOW: Bag of Words assumption

---

.pull-left[
![](07_textAnalaysisII_files/figure-html/plot-bar-1.png)&lt;!-- --&gt;
]

.pull-right[
<div id="htmlwidget-a7eb1d9860d444d5ff22" style="width:504px;height:504px;" class="wordcloud2 html-widget"></div>
<script type="application/json" data-for="htmlwidget-a7eb1d9860d444d5ff22">{"x":{"word":["梦","紧密团结","风华正茂","千秋伟业","向往","同甘共苦","理想信念","踏上","一份","迈向","步伐","气象","欣欣向荣","展现","景象","凋零","呈现","执政党","人口","已经","多名","殷切期望","韶华","底气","志气","先锋","融入","一代代","风雨如晦","火炬","希望","意志","恰是","决心","不要","图谋","粉碎","向前","青春","两岸","领土完整","包括","和平统一","九二","原则","共同愿望","任务","台湾","澳门","保持","稳定","大局","执行","行政区","特别","落实","方针","自治","变味","多万名","肌体","健康","侵蚀","先进性","清除","中央","反腐败","党风廉政","赶考","干部队伍","高素质","在内","以党","道理","一定","打铁","前列","面临","原因","国内外","朝气蓬勃","千锤百炼","寄予","区别","党的建设","磅礴","港人治港","生动","心往","画","最大公约数","天下","一致性","联合","爱国统一战线","积极因素","位置","摆在","大团结","遇水架桥","逢山开道","环境","要求","我国","法律","认识","未有","居安思危","忧患意识","努力","艰巨","信心","接近","不懈","香港","顽强拼搏","敢于胜利","碰得","面前","钢铁长城","干","妄想","绝不允许","病毒","广聚","现在","澳人治澳","奴役","欺负","强烈","不畏强暴","崇尚","目标","车轮","管党","强权政治","宗旨","博弈","共赢","互利","搞","价值","共同","自由","正义","公平","新机遇","一路","关系","新型","独立自主","奉行","赢","合作","展览","忘","展览馆","18","维护者","高度","秩序","建设者","携手前进","进步力量","称王称霸","血液","追求","和睦","共同体","人类","安全","国家主权","手段","可靠","一流","建军","军事","摄新","鞠鹏","观看","一起","观众","回首","万名","同约","领导人","盛大举行","日晚","不会","28","主要矛盾","强大","地区","真理","统一","血与火","枪","一带","指挥","国安","军强","国防","手中","牢牢","领导核心","昂首阔步","说教","颐指气使","教师爷","迎来","损害","精神力量","物质基础","更为","盼","事业","同心圆","独立","贡献","安排","坚决","5000","一系列","根本宗旨","治党","起来","壮志","一国两制","救亡运动","总书记","走","四个","协调","总体布局","统筹","各界","加强","民族","武装","初","源远流长","主动","统揽","步入","灿烂","一招","相对","当代","建议","决定","生活","跨越","民族尊严","充分","总体","老一辈","初级阶段","立志","状况","对抗","落后","香港特别行政区","有益","市场","计划","自我","捍卫","辛亥革命","颁授","陈云","提供","崇高","铭记","特殊","经济总量","归根到底","奔","发愤图强","挑战","历史","方面","彻底","保证","开放","精神文明","经济体制","推进改革","党","新世界","善于","治权","格局","高度集中","继承","多年","奠定","一直","公安干警","共同富裕","大步","大国","社会","人口众多","革命先烈","坚定不移","幸福","从严治党","东方","一穷二白","传承","有史以来","破坏","封建","形成","载入","活力","基本","联系","不负","前进","愁","剥削","转变","绝对","事变","全国","消灭","党员","解放思想","任人宰割","民主","时代化","风雨同舟","特权","条约","李涛","平等","统领","政治","打江山","强加","显著标志","水平","党内","局面","相结合","一盘散沙","结束","温饱","推进","几千年","胜利","解放","中华人民共和国","当家作主","锤炼","义和团运动","封建主义","完善","五位一体","压迫","更大","成员","以后","文艺演出","迈进","奋起","严密","归结","成为","势力","小康","战胜","协同","6","完整","第二个","强国","引领","大踏步","会场","坚持","立党","本质","地上","强","兴国","马克思主义","发展","创造","十八","实事求是","建成","奋斗目标","推翻","书写","欺凌","属于","消防","坚定","党的领导","英勇","劲","第二","问候","最为","前途","传统","优异","探寻","问题","变色","改善","自强","人才","斗争","封闭","社会主义","武警部队","各族人民","自觉","敢教","农民","心中","节日","重大贡献","中华民族","共识","全过程","伟大光荣","同志们","百年","功勋","根本","巩固","太平天国运动","团结","看清楚","呐喊","一去不复返了","展望未来","史诗","十分","汇聚","群众路线","掌握","发展观","鸦片战争","展望","汪洋","政治文明","中华","基本路线","世界形势","列强","法宝","人民军队","积极","2","奔走","全心全意","自信","因素","富裕","己任","意义","使命","抗日战争","守","一个","生态","产生","半封闭","江泽民","方案","不可磨灭","一经","世界","全球","共产党员","一百年","富","蒙难","文化","全党全国","工人","光荣传统","贡献者","重大","难守","保障","苦苦","布局","致以","党和人民","党要","朋友们","矢志不渝","70","劫难","炮响","强军","能够","回顾","光辉","批评","贫困","热烈祝贺","时期","新形态","深切","历程","这是","条件","各国","带来","延续","一道","伟大","限度","今天","开来","中国共产党","赶上","现代化","硬","牺牲","庆祝","反革命","群众","成立","金色","增强","永载史册","颠扑不破","近代","复兴","新","军队","历史进程","诞生","成就","殷","中国化","实现","坚实","接连","一百周年","自豪感","代代相传","品格","党中央","争取","正","一声","充满活力","体系","1840","艰苦","亿多","伟大工程","方向","组织","川流不息","官僚资本主义","日子","旧","阶段","中国","半封建社会","红色","王岐山","蒙辱","谋","头破血流","特色","作出","血肉","29","大变局","善意","建设","危亡","依规","执政","没有","总揽全局","政党","才能救","遭受","顽强","2021","历史性","骨气","治军","代表","演进","反抗","庄严宣告","半殖民地","邓小平","命运","低估","人民","绝不","海内外","从那时起","反对","仁人志士","考验","之路","帝国主义","主题","团结奋斗","此时此刻","核心作用","和平","全方位","一处","救国","共产党","弘扬","公平正义","变质","出台","初心","告终","隆重集会","命脉","生产力","迫切需要","诚挚","创新","前","快速","梦想","思想","转折","物质条件","生死相依","摄","错综复杂","拯救","台独","勇于","知","充满","送来","应对","制度","带领","国家","团体","取得","霸权主义","敬意","周恩来","主心骨","站","废除","紧密结合","基础","应运而生","柱石","具有","历经","高举","十月革命","治理","进程","博古","衰败","开辟","开天辟地","特征","改变","变化","刘少奇","突破","进入","体制","不断","武装挑衅","建党","工人运动","趋势","广泛","确立","飞跃","小康社会","先驱","始终","以史为鉴","力量","奋斗","进行","变革","阻挡","李克强","新民主主义革命","弄","之源","安全观","跃居","丰功伟绩","北伐战争","探索","土地革命战争","救援","三座大山","解放战争","光明","革命","更是","7","1","周年","大会","勋章","北京天安门广场","隆重举行","青年","习近平","中共中央","栗","战书","科技","所系","建立","王沪宁","对党","赵乐际","把握","韩","胡锦涛","大无畏","自信心","出席","新华社","记者","完全","做到","统一战线","气概","革命力量","恢宏","外来","从来","比较完善","道路","社会变革","史册","彪炳史册","观","参观","创建","坚持真理","筑成","保卫","理想","答卷","9500","践行","全人类","担当","中心","不怕牺牲","绝不会","忠诚","英勇斗争","准备","解决","革命烈士","精神","现实","长期","坚守","构建","100","依法治国","谱系","依靠人民","实践","出","鲜明","英才","强盛","继续","赓","续","马克思列宁主义","血脉","永远","矛盾","发扬光大","繁荣","核心","指导思想","更加","七一","仪式","北京人民大会堂","深刻","大厅","主席","共生","觉醒","中央军委","风险","站稳","自力更生","领导","洞察","优秀","获得者","换新天","一同","毛泽东","轮番","同志","怀念","明确","改革","朱德","要用","革命家","寻求","英勇献身","表示","祖国","演出","崇高精神","正在","答应","戊戌变法","创造者","意气风发","真正","任何人","意识","征程","英雄","日月","必须","充分发挥","国际","广大","文明","物质文明","中华儿女","学习","确保","知识分子","民主党派","凝聚","无党派人士","爱国人士","开创","指战员","党和国家","官兵","第一个","队伍","劳动者","同胞","邓小平理论","台湾同胞","侨胞","持续","友好相处","敢于斗争","关心","颠覆","前所未有","支持","影响力","朋友","关注","衷心","谢意","平衡","心","易得","兴替","映照","有着","怎样才能","远","前提","大势","共建","未来","过去","成功","明白","牢记","坚强","德才兼备","饱受","办好","机制","事情","180","体育场","想","着力","光荣","庄严","选择","美好未来","立场","最大","失败","优势","50","利益","不断完善","将来","前景","两个","号召","维护","千辛万苦","国","调动","主要","提高","关键","时代","科学","万岁","依法","各方","伟大成就","百折不挠","美好生活","江山","根基","根本利益","休戚与共","进步","浴血奋战","高质量","从来不","利益集团","权势","一派","共创","特权阶层","能力","分割","对立","企图","共同奋斗","爱好和平","人民团体","澳门特别行政区","蒙尘","得逞","锐意进取","多万","14","服务","下去","贯彻","观察","尊重","方略","拥有","不懈努力","特点","急难","推动","明显","实质性","多样性","进展","法规","立国","人类文明","灵魂","第一","旗帜","充分证明","基本原理","全局","实际","纯洁性","出发","外交政策","艰辛","指导","经验","是因为","正以","发生","行","毛泽东思想","不可","三个代表","重要","不朽","世纪","具体","加快","21","紧紧","路","自立自强","不可逆转","巨大","理论","立足点","交出","人民解放军","得出","党的基本","结论","付出","一群","战略方针","代价","全面","正确","中国式","深化改革","路上","改革开放","立足","侵略","必将","准确","理念","价值体系","和衷共济","民生","人与自然","和谐","战略","美丽","基因","借鉴","般","不足","伟大事业","成果","首创精神","欢迎","深远","接受"],"freq":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,2,2,2,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,3,1,1,1,1,2,1,1,1,2,1,2,1,1,1,1,2,1,2,2,1,1,1,3,1,1,1,1,1,1,1,3,1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,4,3,1,1,1,1,1,2,2,1,3,1,1,1,1,2,1,1,1,1,1,4,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,6,1,3,1,2,1,1,2,3,1,1,1,6,1,1,1,1,5,4,4,2,4,1,3,10,2,2,1,2,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,4,1,1,1,3,2,1,1,1,1,1,1,5,25,1,3,3,4,1,2,1,24,1,3,1,2,1,1,6,1,1,1,1,1,2,7,1,1,2,1,2,1,1,1,1,2,1,4,1,1,2,1,4,1,1,1,1,2,1,4,1,2,1,1,3,1,1,1,1,1,1,1,6,1,1,1,1,1,2,2,1,2,1,16,2,1,2,2,2,1,1,1,2,2,3,1,1,2,1,2,1,1,1,7,1,2,5,1,3,1,3,3,3,1,1,30,1,1,1,1,1,10,33,10,1,1,3,5,1,1,1,1,1,4,1,5,1,1,1,1,4,1,1,1,4,1,1,1,1,5,2,27,1,4,2,1,1,1,1,1,44,2,1,3,9,12,2,5,2,1,12,1,1,1,1,1,1,1,1,1,1,1,1,3,1,2,2,1,1,1,4,1,1,1,1,2,1,1,1,1,5,1,3,6,1,1,1,1,1,1,1,17,2,2,11,1,1,1,2,1,1,1,3,1,1,1,2,4,6,1,9,1,2,1,1,6,3,1,1,1,1,1,2,1,4,2,3,1,1,2,1,2,41,1,4,1,57,1,7,1,3,4,1,2,8,1,4,1,1,3,26,36,2,4,1,3,1,2,33,1,1,1,1,1,1,3,1,4,1,1,3,1,1,3,3,1,2,1,1,1,3,1,80,2,2,3,1,2,1,13,2,2,1,1,1,14,1,1,4,8,1,1,1,1,5,4,6,1,1,6,1,1,5,2,2,7,1,67,1,2,1,2,2,1,2,3,1,1,1,1,7,1,2,1,1,3,1,1,1,4,1,1,1,1,2,1,1,4,1,3,7,1,1,1,2,1,1,1,2,1,1,1,2,7,8,9,1,5,2,2,1,1,2,1,1,1,1,1,4,2,2,1,2,2,1,1,1,1,2,3,2,1,1,2,1,9,1,3,1,1,3,3,2,1,1,10,10,6,16,4,1,1,3,2,1,1,1,1,1,1,1,1,1,1,1,2,7,1,1,1,3,2,2,1,2,5,4,1,3,3,2,2,6,3,1,3,2,3,2,1,1,1,4,4,1,1,3,1,1,1,1,1,1,5,1,2,1,1,1,1,1,1,1,1,1,2,3,1,1,1,1,1,1,1,1,3,1,6,1,2,1,4,4,1,1,1,2,2,1,1,1,7,1,1,3,2,4,1,1,1,1,1,2,2,1,1,7,1,2,1,1,1,5,1,1,8,1,1,1,1,1,2,1,5,4,1,3,1,1,1,1,1,1,3,1,1,1,2,1,1,1,1,1,1,11,2,1,20,1,3,4,5,1,5,1,3,1,1,3,1,1,11,2,4,1,2,1,1,3,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,12,4,2,1,5,5,1,1,1,1,1,1,1,3,2,3,1,2,2,1,3,1,1,1,5,1,1,1,1,1,7,1,1,2,1,1,2,16,2,2,2,1,5,1,2,4,1,1,1,2,1,2,1,1,1,2,1,1,4,1,1,1,1,1,1,2,1,1,1,1,3,1,2,7,1,1,1,3,1,1,1,8,1,1,1,1,1,1,4,1,1,3,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,2,1,4,1,1,1,1,1,1,1,1,1,1,2,1,1,1,2,1,1,2,1,1,1,18,2,1,1,1,3,1,1,2,2,2,1,1,1,1,2,4,1,1,1,1,1,2,1,1,1,1,1],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":2.25,"backgroundColor":"white","gridSize":0,"minRotation":-0.785398163397448,"maxRotation":0.785398163397448,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
]
---

## 关键词分析

Keyword 是个“坑”，还是个“深坑”😫

1. Frequency (?)
1. Co-occurence/Collocation (?)
1. Term frequency–inverse document frequency (TF-IDF, ?)

......


???

TF-IDF: Compare (multiply) term frequency in a document with the inverse document frequency (how rare or common that word is in the entire data set)

The higher the score is, the more relevant the word is to the document.

--


```r
vector_keywords(seg_xi, worker(type = "keywords", topn = 5))
```

```
##      422.611      381.702      355.546      349.027      285.299 
##         "新" "中国共产党"   "中华民族"       "人民"       "伟大"
```

Make sense?

---

## 信息提取

文本中提到了多少次“人民”？


```r
freq_xi %&gt;% 
  filter(grepl("人民", char))
```

```
##             char freq
## 1 中华人民共和国    2
## 2       各族人民    4
## 3       人民军队    4
## 4       党和人民    6
## 5           人民   67
## 6       依靠人民    1
## 7 北京人民大会堂    1
## 8       人民团体    1
## 9     人民解放军    1
```

---

围绕“人民”都说了什么 (n-gram)

.pull-left[

```r
ngram_xi &lt;- NLP::ngrams(seg_xi, n = 2) 

vec_cond &lt;- map_dbl(ngram_xi, ~ grepl("人民", .) %&gt;% 
      sum) %&gt;% as.logical()

ngram_people &lt;- ngram_xi[vec_cond] %&gt;% 
  map(~.[!grepl("人民", .)]) %&gt;% 
  unlist %&gt;% 
  freq 
```
]

.pull-right[
![](07_textAnalaysisII_files/figure-html/bar-people-1.png)&lt;!-- --&gt;
]

---

## 情感分析

Sentiment analysis (or opinion mining)

.center[&lt;img src="images/text_sentiment.jpg" height = 300 /&gt;]

???

在“负-中-正”谱系上界定文本的.red[属性]或.red[位置]

--

.center[
实现方法

1. 自定义词典
1. 调用API
1. 自定义机器学习
]
---

## 基于自定义词典的分析

案例：简·奥斯汀的长篇小说中的情感走向



&lt;img src="07_textAnalaysisII_files/figure-html/plot-sentimentAusten-1.png" width="100%" style="display: block; margin: auto;" /&gt;

???

https://www.tidytextmining.com/sentiment.html

《理智与情感》（1811）
《傲慢与偏见》（1813）
《曼斯菲尔德庄园》（1814）
《埃玛》（1815）
《诺桑觉寺》（1818，去世后出版）
《劝导》（1818，去世后出版）

---

常见中文情感词典：

+ 知网（HowNet）情感词典
+ 台湾大学（NTSUSD）简体中文情感极性词典
+ 大连理工大学情感词汇本体

---

.pull-left[
## 调用API

中文情感分析API：

+ [百度](https://ai.baidu.com/tech/nlp_apply/sentiment_classify)
+ [讯飞](https://www.xfyun.cn/doc/nlp/emotion-analysis/API.html)
+ [腾讯云](https://wiki.open.qq.com/wiki/%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90API)
+ [华为云](https://support.huaweicloud.com/api-nlp/nlp_03_0015.html)
]

.pull-right[
## 机器学习

1. 训练集 &amp;rarr; 预测集
1. 深度学习
]

--

.center[

百度API分析讲话（以段为单位）




|paragraph                          | sentScore|
|:----------------------------------|---------:|
|伟大、光荣、正确的中国共产党万岁！ |  0.999967|
|同志们，朋友们：                   |  0.395675|
]
---

## 语义网络

基于词语关联性（Correlation, collocation, etc.）搭建的社交网络


```r
# count words co-occurring within sections
df_xi_pairs &lt;- df_xiPara %&gt;% 
  group_by(words) %&gt;% 
  filter(n() &gt; 10) %&gt;% 
  widyr::pairwise_cor(words, id, sort = TRUE)
```

---

&lt;img src="07_textAnalaysisII_files/figure-html/plot-semanticNetwork-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

class: inverse, bottom

# 文本分析

---

.pull-left[
## 文字分析

+ 单位：词、句、段、章

+ 目的和方法：
    + 写作特征 &amp;larr; 词频分析
    + 用语特征 &amp;larr; 信息提取
    + 情绪特征 &amp;larr; 情感分析
    + 概念关系 &amp;larr; 语义网络
]

.pull-right[
## 文本分析
+ 单位：篇、部、月、年

+ 目的和方法：
    + 风格判断 &amp;larr; 文本分类
    + 特征提取 &amp;larr; 文本聚类
    + 语义联系 &amp;larr; 语义关系
]

---

## 文本分析基本思路

.pull-left[
方法：

1. 有监督式(Supervised)
1. 半监督式(Semi-supervised)
1. 无监督是(Unsupervised)
]

.pull-right[
材料：

1. 训练集(training set)
1. 预测集(testing set)

]

---

## 文本分类（Classification/Scaling)

已知类别 &amp;rarr; 量化特性 &amp;rarr; “装箱/标记”

1. 内容比较
1. 作者预测
1. 文体划分

--

形式：

1. 有监督式分类
1. 半监督式分类

--

思路：

学习训练集 &amp;rarr; 确定辨识规律 &amp;rarr; 使用检验集验证规律有效性      
&amp;rArr; 
使用规律分类预测集

---

class: center, middle

&lt;img src="images/text_trainingTest.png" height = 500 /&gt;

---

## 文本分类

\1. 训练集导入


```r
library(tidytext)
library(gutenbergr)

titles &lt;- c("The War of the Worlds","Pride and Prejudice")

books &lt;- gutenberg_works(title %in% titles) %&gt;%
  gutenberg_download(meta_fields = "title") %&gt;%
  mutate(document = row_number())

books
```

```
## # A tibble: 20,673 x 4
##    gutenberg_id text                           title        document
##           &lt;int&gt; &lt;chr&gt;                          &lt;chr&gt;           &lt;int&gt;
##  1           36 "The War of the Worlds"        The War of ~        1
##  2           36 ""                             The War of ~        2
##  3           36 "by H. G. Wells [1898]"        The War of ~        3
##  4           36 ""                             The War of ~        4
##  5           36 ""                             The War of ~        5
##  6           36 "     But who shall dwell in ~ The War of ~        6
##  7           36 "     inhabited? .  .  .  Are~ The War of ~        7
##  8           36 "     World? .  .  .  And how~ The War of ~        8
##  9           36 "          KEPLER (quoted in ~ The War of ~        9
## 10           36 ""                             The War of ~       10
## # ... with 20,663 more rows
```

---

\2. 训练集清理（segment, token, stemming等)

+ 划分比较单位（行、段、章、本等)
+ 保留常用词


```r
tidy_books &lt;- books %&gt;%
  unnest_tokens(word, text) %&gt;%
  group_by(word) %&gt;%
  filter(n() &gt; 10) %&gt;% # keep words occurring over 10 times
  ungroup()

tidy_books
```

```
## # A tibble: 159,743 x 4
##    gutenberg_id title                 document word 
##           &lt;int&gt; &lt;chr&gt;                    &lt;int&gt; &lt;chr&gt;
##  1           36 The War of the Worlds        1 the  
##  2           36 The War of the Worlds        1 war  
##  3           36 The War of the Worlds        1 of   
##  4           36 The War of the Worlds        1 the  
##  5           36 The War of the Worlds        3 by   
##  6           36 The War of the Worlds        6 but  
##  7           36 The War of the Worlds        6 who  
##  8           36 The War of the Worlds        6 shall
##  9           36 The War of the Worlds        6 in   
## 10           36 The War of the Worlds        6 these
## # ... with 159,733 more rows
```

---

\3. 特征提取（高频词等）


```r
tidy_books %&gt;%
  count(title, word, sort = TRUE) %&gt;%
  anti_join(get_stopwords()) %&gt;%
  group_by(title) %&gt;%
  top_n(20) %&gt;%
  ungroup() %&gt;%
  ggplot(aes(reorder_within(word, n, title), n,
    fill = title
  )) +
  geom_col(alpha = 0.8, show.legend = FALSE) +
  scale_x_reordered() +
  coord_flip() +
  facet_wrap(~title, scales = "free") +
  scale_y_continuous(expand = c(0, 0)) +
  labs(
    x = NULL, y = "Word count",
    title = "Most frequent words after removing stop words",
    subtitle = "Words like 'said' occupy similar ranks but other words are quite different"
  )
```

---

&lt;img src="07_textAnalaysisII_files/figure-html/output-classification-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

\4. （依据特征）判断预测集

（一段文字这些词用得越多，越可能是某个作者的，that's it 😋)

???
https://juliasilge.com/blog/tidy-text-classification/

One can perform other types of comparison, e.g., with tf-idf


---

class: middle

.pull-left[
### 文本分类·有监督式

1. 训练集导入
1. 训练集清理
1. 人工特征提取
1. 检验集评估*
1. 判断预测集
]

.pull-right[
### 文本分类·半监督式

1. 训练集导入
1. 训练集清理
1. .red[机器]特征提取
1. 检验集.red[评估]
1. 判断预测集
]

---

## 机器学习辅助特征提取

让我们来造一个训练集 vis-&amp;agrave;-vis 预测集


```r
library(rsample)

books_split &lt;- books %&gt;%
  select(document) %&gt;%
  initial_split() # prop = 3/4
train_data &lt;- training(books_split)
test_data &lt;- testing(books_split)
```

---

## 机器学习特征提取操作步骤

\1. 建构sparse matrix


```r
sparse_words &lt;- tidy_books %&gt;%
  count(document, word) %&gt;%
  inner_join(train_data) %&gt;%
  cast_sparse(document, word, n)

dim(sparse_words)
```

```
## [1] 12867  1654
```

```r
# Create a response variable to associate each of the rownames() of the sparse matrix 

word_rownames &lt;- as.integer(rownames(sparse_words))

books_joined &lt;- data_frame(document = word_rownames) %&gt;%
  left_join(books %&gt;%
    select(document, title))
```

(可以并入meta data作为新features)

???

12,028 training observations and 1652 features

---

\2. 通过机器学习生成分类器

基于LASSO regularization 

其他分类器: Naive Bayes, Wordscores, Wordfish（也可使用SVM、深度神经网络等）

--


```r
library(glmnet)
library(doParallel)
registerDoParallel(cores = 8)

is_jane &lt;- books_joined$title == "Pride and Prejudice"
model &lt;- cv.glmnet(sparse_words, is_jane,
  family = "binomial",
  parallel = TRUE, 
  keep = TRUE
)
```

---

&lt;img src="07_textAnalaysisII_files/figure-html/plot-lasso-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

\3. .red[Validation! Validation! Validation!]

结果是不是make sense?

对分类影响最大的coefficients有哪些?   
（择取第一个标准差的系数/词）


```r
library(broom)

coefs &lt;- model$glmnet.fit %&gt;%
  tidy() %&gt;%
  filter(lambda == model$lambda.1se)
```

---

## 提到Maritians的不太可能是奥斯汀的作品🥱

&lt;img src="07_textAnalaysisII_files/figure-html/plot-largeLambda-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

\4. 检验集评估


```r
intercept &lt;- coefs %&gt;%
  filter(term == "(Intercept)") %&gt;%
  pull(estimate)

classifications &lt;- tidy_books %&gt;%
  inner_join(test_data) %&gt;%
  inner_join(coefs, by = c("word" = "term")) %&gt;%
  group_by(document) %&gt;%
  summarize(score = sum(estimate)) %&gt;%
  mutate(probability = plogis(intercept + score))

classifications
```

```
## # A tibble: 4,282 x 3
##    document    score probability
##       &lt;int&gt;    &lt;dbl&gt;       &lt;dbl&gt;
##  1        6   1.65     0.916    
##  2       13  -0.418    0.580    
##  3       24   0.0480   0.688    
##  4       29  -3.56     0.0561   
##  5       38  -3.70     0.0493   
##  6       40  -0.836    0.476    
##  7       45 -11.1      0.0000330
##  8       46  -7.14     0.00167  
##  9       47  -0.693    0.512    
## 10       49  -3.07     0.0889   
## # ... with 4,272 more rows
```

???

并入检验集，右侧是可能性概率

---

## 何为有效

法1：Receiver Operating Characteristic (ROC) Curve


.pull-left[
`$$TPR = \frac{TP}{TP + FN}$$`
判断是奥斯汀写的/实际是奥斯汀写的    


`$$FPR = \frac{FP}{FP + TN}$$`

判断非奥斯汀写的/实际非奥斯汀写的
]

--

.pull-right[&lt;img src="images/text_ROC.png" height = 500 /&gt;]

---

&lt;img src="07_textAnalaysisII_files/figure-html/evaluate-roc-1.png" width="100%" style="display: block; margin: auto;" /&gt;


使用AUC也可以

???

Area under the ROC Curve: AUC measures the entire two-dimensional area underneath the entire ROC curve from (0,0) to (1,1).

---

法2：Confusion Matrix

ROC的粗暴2 &amp;times; 2 版（以50%可能性为界）

&lt;img src="07_textAnalaysisII_files/figure-html/evaluate-CM-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

## 哪些错了？Type I &amp; Type II Errors

.center[&lt;img src="../analysisOfPoliticalData/images/errorType.png" height = 550 /&gt;]

---

不是但错认为奥斯汀写的 (Type I, prob &gt; 0.5)


```r
comment_classes %&gt;%
  mutate(
    prediction = case_when(
      probability &gt; 0.5 ~ "Pride and Prejudice",
      TRUE ~ "The War of the Worlds"
    ),
    prediction = as.factor(prediction)
  ) %&gt;%
  conf_mat(title, prediction) %&gt;% 
  autoplot
```

![](07_textAnalaysisII_files/figure-html/evaluate-typeI-1.png)&lt;!-- --&gt;

---

是但未被认为奥斯汀写的 (Type II, prob &lt; 0.3)


```r
comment_classes %&gt;%
  filter(
    probability &lt; .3,
    title == "Pride and Prejudice"
  ) %&gt;%
  sample_n(10) %&gt;%
  inner_join(books %&gt;%
    select(document, text)) %&gt;%
  select(probability, text)
```

```
## # A tibble: 10 x 2
##    probability text                                                 
##          &lt;dbl&gt; &lt;chr&gt;                                                
##  1      0.160  "      I remember the time when I liked a red coat m~
##  2      0.0250 "      keep a pack of foxhounds, and drink a bottle ~
##  3      0.0748 "      whole scene, the river, the trees scattered o~
##  4      0.0764 "      to it, or of the people who lived in it, the ~
##  5      0.164  "      by the self-conceit of a weak head, living in~
##  6      0.191  "      things enough happened in the time. Good grac~
##  7      0.193  "      might possibly happen almost took from me my ~
##  8      0.151  "      pointing out those parts of the stream where ~
##  9      0.210  "      to the window, by the sound of a carriage; an~
## 10      0.141  "      dressed up Chamberlayne in woman’s clothes on~
```

---

想知道更多？

Emil Hvitfeldt &amp; Julia Silge [Supervised Machine Learning for Text Analysis in R](https://smltar.com/)

.center[&lt;img src="images/text_machineLearningBook.tif" height = 500 /&gt;]

---

## Classification vs. Scaling

.pull-left[
### Classification: 装箱

+ 作者
+ 风格、流派
+ 时期

&lt;img src="images/text_visClassification.gif" height = 350 /&gt;
]

--

.pull-right[
### Scaling：标签，latent traits

+ Ideology
+ Policy standpoint
+ Soft facts vs. hard facts   
......

&lt;img src="images/text_visScaling.jpeg" height = 350 /&gt;

]

???

https://lse-me314.github.io/lecturenotes/ME314_day10.pdf

---

.pull-left[
### 文本分类（Classification)

.red[已知]分类 &amp;rarr; 量化个性 &amp;rarr; “装箱”

1. 内容比较
1. 作者预测
1. 文体划分

形式：

1. 有监督式分类
1. 半监督式分类
]

.pull-right[
### 文本聚类 (Clustering)

.red[未知]差异 &amp;rarr; 量化共性 &amp;rarr; “分包”

1. 物以类聚
1. 概念提取

形式：

半监督式聚类    
无监督式聚类

1. 单标签聚类
1. 混合标签聚类
]

---

## 单标签聚类（Single-Membership Clustering)

量化共性 &amp;rarr; 相似归组 &amp;rarr; 最大化.blue[组内]相似度，最小化.blue[组间]相似度

--

### 归组逻辑

Hierarchical/Agglomerative

起点：各点各自一组    
过程：不断合并距离最近组

Point Assignment

起点：随机将点分组    
过程：不断改变分组方式使组内距离最小

---

## 距离

两个数据点的相异程度

--

### 空间距离测算法

.pull-left[


Euclidean Distance

&lt;img src="images/text_euclidean.png" height = 350 /&gt;


]

--

.pull-right[

Manhattan Distance
&lt;img src="images/text_manhattan.png" height = 350 /&gt;

]

???

https://www.datanovia.com/en/lessons/clustering-distance-measures/
https://shairozsohail.medium.com/a-comprehensive-introduction-to-clustering-methods-1e1e4f95b501

---

### 相似性距离测算法

.center[
Pearson metrics

Spearman metrics

Kendall metrics

Cosine metrics
]

--

.center[欢迎来 70700173	治理技术专题：政治数据分析 🎉]

---

## Hierarchical Clustering

聚类美国总统国情咨文


```r
library(quanteda)
library(quanteda.corpora)
library(quanteda.textstats)
pres_dfm &lt;- tokens(corpus_subset(data_corpus_sotu, Date &gt; "1980-01-01"), remove_punct = TRUE) %&gt;%
  tokens_wordstem("en") %&gt;%
  tokens_remove(stopwords("en")) %&gt;%
  dfm() %&gt;%
  dfm_trim(min_termfreq = 5, min_docfreq = 3)

# hierarchical clustering - get distances on normalized dfm
pres_dist_mat &lt;- dfm_weight(pres_dfm, scheme = "prop") %&gt;%
    textstat_dist(method = "euclidean") %&gt;% 
    as.dist()

# hiarchical clustering the distance object
pres_cluster &lt;- hclust(pres_dist_mat)
```


???

https://books.psychstat.org/textmining/cluster-analysis.html

---

&lt;img src="07_textAnalaysisII_files/figure-html/plot-hiearchical-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

## Point Assignment

K-mean

.center[&lt;img src="images/text_kmean.gif" height = 500 /&gt;]


---


```r
k &lt;- 4

pres_kmean &lt;- stats::kmeans(pres_dist_mat, 
                            centers = k,
                            nstart = 10) # number of iterations
```

&lt;img src="07_textAnalaysisII_files/figure-html/plot-kmean-1.png" width="100%" style="display: block; margin: auto;" /&gt;


---

Get the K right

检验1--20个mean之区别

&lt;img src="07_textAnalaysisII_files/figure-html/knum-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

&lt;img src="07_textAnalaysisII_files/figure-html/plot-kmean6-1.png" width="50%" /&gt;&lt;img src="07_textAnalaysisII_files/figure-html/plot-kmean6-2.png" width="50%" /&gt;

---

## 混合标签聚类（Mixed-Membership Clustering)

.pull-left[

主题模型(Topic modeling)

主题: 概念

Decisions:

1. 主题数量
1. 起始点
1. 主题.red[含义]
]

.pull-right[
&lt;video width="500" height="500" controls&gt;
&lt;source src="images/text_topicModeling.webm" type="video/webm"&gt;
&lt;/video&gt;
]

---

## 主题模型举例

What does "democracy" mean in Chinese political language?

--

.center[&lt;img src="images/text_theoryMap.png" height = 500 /&gt;]

---

Structural Equation Model

1. Identifying concept and conceptual relations
1. Meta data

--

Data: 

People's Daily (1949--2003)

--

Decisions:

1. How many topics?
1. Model robustness?
1. Meanings of the topics?

---

## How Many Topics?

Data driven: Testing 20--140 topics

Criteria:

1. Leveraging held-out likelihood and semantic coherence
1. Residual dropped more

--

&amp;rArr; 40 topics


---

## Model Robustness

### Influences beyond the text per se

Controls:

1. Time dependency
1. Period
1. Holidays and two Sessions ("Liang Hui")

--

### Avoiding initialization sensitivity


Drop low likelihood values after 20 E-M iterations;     
Only the highest 20% were converged and the one with highest semantic coherence and exclusivity were used.

---

## Model Interpretation

Five vital concepts: Democracy, liberal values, regime feature, national priority (economy, security, stability)

Keywords &amp;harr; FREX score words

---

## Conceptual Network

Topic Correlations across years

.pull-left[
### 1991

&lt;img src="images/text_democracy1991.png" height = 400 /&gt;
]
.pull-right[
### 1997

&lt;img src="images/text_democracy1997.png" height = 400 /&gt;
]

---

## What Can Explain Democracy Within and Between Discourses

.center[&lt;img src="images/text_democracyCoef.png" height = 500 /&gt;]

---

## Bonus: 语义关系

vector("paris")−vector("france")+vector("germany")

.center[&lt;img src="images/text_wordEmbedding.png" height = 500 /&gt;]

???

https://towardsdatascience.com/word-embeddings-for-nlp-5b72991e01d4

高纬度词汇降维表达相近的向量(关系)

降维方式：

PCA/LSA

Word2Vec

GloVe: Leverage LSA and skip-gram model of Mikolov (Word2Vec)

https://www.cnblogs.com/mantch/p/11403771.html

LSA（Latent Semantic Analysis）是一种比较早的count-based的词向量表征工具，它也是基于co-occurance matrix的，只不过采用了基于奇异值分解（SVD）的矩阵分解技术对大矩阵进行降维，而我们知道SVD的复杂度是很高的，所以它的计算代价比较大。还有一点是它对所有单词的统计权重都是一致的。而这些缺点在GloVe中被一一克服了。

而word2vec最大的缺点则是没有充分利用所有的语料，所以GloVe其实是把两者的优点结合了起来。从这篇论文给出的实验结果来看，GloVe的性能是远超LSA和word2vec的，但网上也有人说GloVe和word2vec实际表现其实差不多。

https://towardsdatascience.com/word-embeddings-for-nlp-5b72991e01d4

---

## Take-Home Points

.pull-left[
### 文字分析

+ 单位：词、句、段、章
+ 目的和方法：
    + 写作特征 &amp;larr; 词频分析
        + **高频词、关键词**
    + 用语特征 &amp;larr; 信息提取
        + **特征词、N-gram**
    + 情绪特征 &amp;larr; 情感分析
        + **词典、调用API、机器学习**
    + 概念关系 &amp;larr; 语义网络
        + **共现、相关性**

]

.pull-right[
### 文本分析

+ 单位：篇、部、月、年

+ 目的和方法：
    + 风格判断 &amp;larr; 文本分类
        + **有监督、机器学习**
    + 特征提取 &amp;larr; 文本聚类
        + **单标签（hierarchical, point assignment）**
        + **混合标签（主题模型）**
    + 语义联系 &amp;larr; 语义关系
        + **Word embedding (word2vec, GloVe)**
]

---

class: inverse, center, middle

# Thank you!

&lt;i class="fa fa-envelope fa-lg"&gt;&lt;/i&gt;&amp;nbsp; [yuehu@tsinghua.edu.cn](mailto:yuehu@tsinghua.edu.cn) 

&lt;i class="fa fa-globe fa-lg"&gt;&lt;/i&gt;&amp;nbsp; https://sammo3182.github.io/

&lt;i class="fab fa-github fa-lg"&gt;&lt;/i&gt;&amp;nbsp; [sammo3182](https://github.com/sammo3182)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
